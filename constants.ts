import { Chapter, Difficulty } from "./types";

export const APP_NAME = "TenorArb";

export const COURSE_CONTENT: Chapter[] = [
  {
    id: "101",
    title: "第一章：套利的本质",
    description: "为什么市场上存在“免费的午餐”？理解期限套利的核心逻辑。",
    difficulty: Difficulty.BEGINNER,
    diagramType: "basis-convergence",
    content: `
## 1.1 什么是期限套利 (Cash-and-Carry)？

在金融世界里，**期限套利**是指利用**现货 (Spot)** 与 **期货 (Futures)** 之间的价格差异（即**基差**），构建一个风险被完全对冲的投资组合，从而获取**无风险收益**的策略。

### 简单理解
想象黄金市场：
*   **现货价格**：一手交钱，一手交金条。
*   **期货价格**：约定在未来某个时间（如6个月后）以特定价格交易金条。

当 **期货价格 > 现货价格 + 持有成本** 时，你可以：
1.  借钱买入现货。
2.  同时卖出期货合约（锁定未来的卖出价）。
3.  持有到期交割。

**结果**：无论未来金价涨到天际还是跌入谷底，你的利润在开仓那一刻就已经被锁定了。

---

## 1.2 为什么会有价差？(Contango)

在正常的商品市场中，远期价格通常高于近期价格，这种结构称为 **正向市场 (Contango)**。
这是因为持有实物资产是有成本的（仓储、保险、资金占用）。期货买家愿意支付溢价，因为他们不需要现在就支付全款，也不需要自己保管货物。

---

## 1.3 现实世界的门槛 (为什么不都在做？)

如果这真是“免费的午餐”，为什么不是每个人都在做？为什么还有穷人？
因为在理论与实践之间，横亘着几座大山：

#### 1. 资金效率门槛 (Capital Efficiency)
!LOCK 套利通常是**低回报**策略。
年化收益率通常在 **5% - 15%** 之间。这对于拥有 1亿资金的机构来说非常有吸引力（几乎无风险），但对于只有 1万本金的散户，一年赚 500-1500 元可能连电费都不够。散户更倾向于追求高风险高回报的博弈。

#### 2. 执行与交易成本 (Friction)
!ALERT 理论上你可以同时买卖，实际上有滑点。
你需要同时在现货市场买入、在期货市场卖出。如果你买入现货后，期货价格突然跳水，你的利润瞬间就被**滑点 (Slippage)** 和**交易手续费**吃光了。这需要专业的程序化交易工具。

#### 3. 跨期保证金 (Margin Requirements)
虽然你对冲了价格风险，但交易所**不一定承认**你的现货可以抵消期货的保证金。
你需要在期货账户里压大量的现金防止爆仓。这极大地降低了资金利用率 (Leverage)，使得实际收益率进一步打折。

#### 4. 技术与通道
真正的无风险套利机会稍纵即逝，往往由高频交易机器人 (HFT) 毫秒级捕获。普通人手动下单时，价差可能已经消失了。
    `
  },
  {
    id: "201",
    title: "第二章：定价模型与公式",
    description: "深入解析持有成本模型 (Cost of Carry Model)。",
    difficulty: Difficulty.INTERMEDIATE,
    diagramType: "none",
    content: `
## 2.1 核心定价公式

期货的理论价格并非随意波动，而是由现货价格和持有成本严格锚定的。

> **持有成本公式：**
> $$F_t = S_t \\times e^{(r + u - y)(T-t)}$$

其中各个参数代表：
*   $$F_t$$: **期货理论价格**
*   $$S_t$$: **现货当前价格**
*   $$r$$: **无风险利率** (资金成本，如国债利率)
*   $$u$$: **仓储成本** (Storage Cost，百分比形式)
*   $$y$$: **便利收益率** (Convenience Yield，持有实物带来的隐性收益)
*   $$T-t$$: **距离交割的时间** (年化)

## 2.2 公式的含义

这个公式告诉我们：
**期货价格 = 现货价格 + 资金利息 + 仓储费 - 便利收益**

如果市场上的实际期货价格 $$F_{actual}$$ 大于公式计算出的 $$F_{theoretical}$$，就意味着期货被高估了，**套利机会出现**。

### 举例计算
*   现货黄金 $2000，年利率 5%，仓储费 0%，便利收益 0%。
*   1年后交割的期货理论价格应为：$$2000 \\times (1 + 0.05) = 2100$$。
*   如果市场上的期货价格是 **$2150**，那么中间的 **$50** 就是你可以锁定的无风险利润。
    `
  },
  {
    id: "301",
    title: "第三章：黄金实战全流程",
    description: "以 COMEX 黄金期货 (GC) 为例，手把手教你如何操作。",
    difficulty: Difficulty.INTERMEDIATE,
    diagramType: "none",
    content: `
## 3.1 准备工作
假设你是一个机构交易员，拥有 **$1,000,000** 资金。
*   **标的**：COMEX 黄金 (每手 100 盎司)。
*   **现货**：$2,000 / oz。
*   **期货 (6个月后)**：$2,060 / oz。

## 3.2 步骤详解 (SOP)

1.  **买入现货 (Long Spot)**
    *   花费 $200,000 买入 100 盎司黄金现货。
    *   (通常使用杠杆，只需部分保证金，但为了安全我们假设全款)。

2.  **卖出期货 (Short Futures)**
    *   卖出 1 手黄金期货合约 (对应 100 盎司)。
    *   开仓价格：$2,060。
    *   此时，你锁定了 **$60/oz** 的价差。

3.  **持有 (Carry)**
    *   将黄金存入金库（需支付少量仓储费）。
    *   **关键点**：随着时间流逝，期货价格会逐渐向现货价格靠拢（基差收敛）。

4.  **交割或平仓**
    *   **方法A (实物交割)**：到期日，将金库里的金条交给交易所，收到 $2,060/oz 的现金。
    *   **方法B (平仓对冲)**：在到期前一刻，同时卖出现货、买入平仓期货。此时两者价格几乎相等。

**净利润** = $60 (价差) - 资金成本 - 仓储费。
    `
  },
  {
    id: "401",
    title: "第四章：基差结构与收敛",
    description: "理解利润的来源：时间是你的朋友。",
    difficulty: Difficulty.ADVANCED,
    diagramType: "basis-convergence",
    content: `
## 4.1 基差 (Basis) 的定义

**基差 = 期货价格 - 现货价格** (注：有些定义相反，这里采用 Contango 结构下的定义)。

在套利开始时，基差是正的（如 $60）。
在交割日，**基差必须为 0**。

## 4.2 强制收敛机制

为什么基差一定会归零？
因为如果交割日当天，期货价格比现货贵 $10，所有人都会：
1.  买入现货
2.  卖出期货
3.  立即交割
4.  瞬间赚取 $10

这种**无风险套利**行为会瞬间产生巨大的买压和卖压，迫使价格拉平。

## 4.3 市场结构变异
*   **Contango (正向市场)**：期货 > 现货。适合正向套利（买现货抛期货）。
*   **Backwardation (反向市场)**：现货 > 期货。这通常发生在现货极度短缺时（如战争、供应链断裂）。此时套利逻辑反转：**卖出现货，买入期货**（如果你库存有货的话）。
    `
  },
  {
    id: "501",
    title: "第五章：致命风险 (Margin Call)",
    description: "90% 的新手死于资金管理。如何避免在黎明前倒下？",
    difficulty: Difficulty.ADVANCED,
    diagramType: "none",
    content: `
## 5.1 保证金隔离风险

虽然你的总体仓位是**市场中性**的（一多一空），但交易所通常**只对你的期货账户进行每日结算 (Mark-to-Market)**。

### 爆仓剧本
1.  你以 $2000 买入现货，以 $2050 做空期货。
2.  金价突然**暴涨**至 $2500。
3.  **现货端**：你赚了 $500，但这通常是未实现利润，且在现货账户里。
4.  **期货端**：你亏了 $450 (空单浮亏)。交易所要求你**立即**补缴 $450 现金作为保证金。
5.  如果你没现金了（全买现货了），交易所会**强行平仓你的期货空单**。
6.  **结果**：你变成了裸多现货。如果随后金价大跌回 $2000，你现货利润回吐，而期货的实亏已经发生。**你破产了。**

## 5.2 解决方案
*   **留足缓冲**：永远不要满仓。如果使用杠杆，建议杠杆率不超过 3倍。
*   **资金划转**：确保现货账户的钱能快速转入期货账户（这在跨交易所套利时非常困难）。
    `
  },
  {
    id: "601",
    title: "第六章：展期 (Rolling) 的艺术",
    description: "不想实物交割怎么办？如何将合约移到下个月。",
    difficulty: Difficulty.ADVANCED,
    diagramType: "none",
    content: `
## 6.1 什么是展期？

大多数套利者并不想真的去搬运金条。在合约即将到期时，他们会：
1.  **买入平仓** 近月合约（Close Near Month）。
2.  **卖出开仓** 远月合约（Open Far Month）。

## 6.2 展期价差 (Calendar Spread)

展期的盈亏取决于两个合约之间的价差。
*   **理想情况**：远月价格 >> 近月价格。你在平仓近月的同时，在更高的价格卖出了远月，相当于**多吃了一段基差**。
*   **风险情况**：如果市场转为 Backwardation，远月价格 < 近月价格。你不得不低价卖出远月，这会**吞噬你的利润**。

**专家提示**：展期是套利策略长期存续的关键。你需要密切关注 **"Rollover Yield"**。
    `
  },
  {
    id: "701",
    title: "第七章：专家进阶与反向套利",
    description: "当市场结构反转时，如何利用手中的现货获利？",
    difficulty: Difficulty.ADVANCED,
    diagramType: "none",
    content: `
## 7.1 反向套利 (Reverse Cash-and-Carry)

当 $$S_t > F_t$$ (Backwardation) 时：
1.  **卖出** 手中的现货黄金（获得现金 + 利息）。
2.  **买入** 被低估的期货合约。
3.  到期时，接收期货交割的黄金，补回库存。

**收益来源**：
1.  现货变现后的资金利息 ($$r$$)。
2.  低价买回黄金产生的价差。

## 7.2 隐含回购率 (Implied Repo Rate)

机构交易员通常不看绝对价差，而是计算**隐含回购率**：
> $$IRR = \\left( \\frac{F_t - S_t}{S_t} \\right) \\times \\frac{360}{d}$$

其中：
*   $$d$$：距离合约到期的天数 (Days to Maturity)。
*   360：货币市场常用的年化基准天数 (亦可用 365)。

*   如果 IRR > 你的资金成本：**做正向套利**。
*   如果 IRR < 你的资金成本：**不做，或做反向套利**。

这是华尔街量化团队进行高频决策的核心指标。
    `
  }
];

export const INITIAL_SIMULATION_STATE = {
  cash: 100000,
  spotPosition: 0,
  futuresPosition: 0,
  entrySpotPrice: 0,
  entryFuturesPrice: 0,
  currentSpotPrice: 2000,
  currentFuturesPrice: 2050,
  timeToMaturity: 90,
  maintenanceMarginRatio: 0.1, // 10% maintenance margin for futures
  isLiquidated: false,
  scenario: 'NORMAL',
  history: []
};
